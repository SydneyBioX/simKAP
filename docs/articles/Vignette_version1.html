<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SimKAP--simulation of the kidney allocation process • simKAP</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="SimKAP--simulation of the kidney allocation process">
<meta property="og:description" content="simKAP">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simKAP</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Vignette_version1.html">SimKAP--simulation of the kidney allocation process</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Vignette_version1_files/header-attrs-2.10/header-attrs.js"></script><script src="Vignette_version1_files/htmlwidgets-1.5.3/htmlwidgets.js"></script><script src="Vignette_version1_files/jquery-3.5.1/jquery.min.js"></script><link href="Vignette_version1_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="Vignette_version1_files/datatables-binding-0.18/datatables.js"></script><link href="Vignette_version1_files/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="Vignette_version1_files/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="Vignette_version1_files/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="Vignette_version1_files/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="Vignette_version1_files/crosstalk-1.1.1/js/crosstalk.min.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>SimKAP–simulation of the kidney allocation process</h1>
                        <h4 class="author">Yunwei Zhang</h4>
            <address class="author_afil">
      School of Mathematics and Statistics, The University of Sydney, AustraliaCharles Perkins Centre, The University of Sydney, Australia<br><div class="hidden name"><code>Vignette_version1.Rmd</code></div>

    </address>
</div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p><code>simKAP</code> is an R package to simulate the kidney alocation process to get realistic recipient-donor pairs take into consideration of <strong>human intervention</strong> and <strong>dynamic waiting list modeling</strong>.<br>
This vignette will walk through the implementation of this process using <strong>Australia recipient waiting list</strong>, <strong>Australia transplantation data</strong> and under <strong>Australia kidney allocation algorithm</strong>. With this demonstration using working exmaple, you will be able to customise your allocation process with modified functions such as a new National allocation (see section <strong>Customisable allocation process</strong>)</p>
</div>
<div id="loading-packages-and-data" class="section level1">
<h1 class="hasAnchor">
<a href="#loading-packages-and-data" class="anchor"></a>Loading Packages and Data</h1>
<p>First, load <code>simKAP</code> via install <code>simKAP</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"simKAP"</span><span class="op">)</span></code></pre></div>
<p>We also load other packages for this vignette.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/DT">DT</a></span><span class="op">)</span></code></pre></div>
<p>Then, we load the example data sampled from Australia kidney allocation database.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">simKAP</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"rawdata"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"newdata"</span><span class="op">)</span>
<span class="va">recip_sample_list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"recip_sample_list.rds"</span><span class="op">)</span>
<span class="va">raw_donor_matrix</span><span class="op">$</span><span class="va">donor_rank</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html">rank</a></span><span class="op">(</span><span class="va">raw_donor_matrix</span><span class="op">[</span>,<span class="st">'donor_kdri'</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">raw_donor_matrix</span><span class="op">)</span></code></pre></div>
<p>Notice here, the features required from the historical transplant data are listed below:</p>
<div id="htmlwidget-b50a557e882c17c49ffa" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b50a557e882c17c49ffa">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28"],["donor_source","donor_state","donor_blgroup","donor_a1","donor_a2","donor_b1","donor_b2","donor_dr1","donor_dr2","donor_dq1","donor_dq2","donor_height","donor_weight","donor_eth_code","donor_eth_country","donor_eth","donor_diabetes","donor_hypertension","donor_smoker","donor_id","donor_death","donor_dcd","donor_creatinine","donor_age","donor_sex","donor_kdri","tx_date","num_kidney"],["Living donor or deceased donor (character)","State of the donor (character)","Blood group of the donor (character)","Donor HLA-A1 value (numeric)","Donor HLA-A2 value (numeric)","Donor HLA-B1 value (numeric)","Donor HLA-B2 value (numeric)","Donor HLA-DR1 value (numeric)","Donor HLA-DR2 value (numeric)","Donor HLA-DQ1 value (numeric)","Donor HLA-DQ2 value (numeric)","Height of the donor (numeric)","Weight of the donor (numeric)","Code of the donor's ethnicity (numeric)","Country of the donor (character)","Ethnicity of the donor (character)","Diabetes of the donor (character)","Hypertension of the donor (character)","If the donor is a smoker or not (character)","ID of the donor (character)","Cause of death of the donor (character)","If the donor is the extended criteria (character)","Creatinine level of the donor (numeric)","Age of the donor (numeric)","Sex of the donor (character)","KDRI of the donor (numeric)","Donated date (date object in R)","The number of kidneys (numeric)"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>donor_feature<\/th>\n      <th>donor_explain<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script><div id="htmlwidget-6c847c2eeb206de1189d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-6c847c2eeb206de1189d">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49"],["recip_id","recip_graftno","recip_pra","recip_blgroup","recip_a1","recip_a2","recip_b1","recip_b2","recip_dr1","recip_dr2","recip_dq1","recip_dq2","recip_state_initial","recip_state_current","recip_age_rrtstart","recip_sex","recip_eth_detailed","recip_eth","recip_primrenal","recip_biopsy","recip_creatinine","recip_height","recip_weight","recip_smoker","recip_rrtstartdate","recip_deathdate","recip_state","recip_age","recip_waittime","recip_lung","recip_coronary","recip_pvd","recip_cvd","recip_diabetes","recip_comorb_date","recip_cancer","recip_liststartdate","recip_waitstatus","recip_listtime","recip_epts","riskscore","recip_algorithm","recip_id_original","recip_original_listdate","recip_original_rrtstartdate","recip_tx_date","recip_birthdate","pra_group","recip_age_group"],["ID of the recipient (character)","Number of kidney the recipient will have (numeric)","PRA level of the recipient (numeric)","Blood group of the recipient (character)","Recipient HLA-A1 value (numeric)","Recipient HLA-A2 value (numeric)","Recipient HLA-B1 value (numeric)","Recipient HLA-B2 value (numeric)","Recipient HLA-DR1 value (numeric)","Recipient HLA-DR2 value (numeric)","Recipient HLA-DQ1 value (numeric)","Recipient HLA-DQ2 value (numeric)","Initial state of the recipient (character)","Current state of the recipient (character)","Age when dialysis first started of the recipient (numeric)","Gender of the recipient (character)","Ethinicity of the recipient (character)","Ethinicity code of the recipient (numeric)","Primary kidney of the recipient (character)","recip_biopsy If biopsy for the recipient (character)","Creatinine level of the recipient (numeric)","Height of the recipient (numeric)","Weight of the recipient (numeric)","If the recipient is a smoker or not (character)","Dialysis start date (date object in R)"," Death date of the recipient (date object in R)","State of the recipient (character)","Age of the recipient (numeric)","Waiting time of the recipient (numeric)","Lung disease of the recipient (character)","Coronary disease of the recipient (character)","PVD of the recipient (character)","CVD of the recipient (character)","Diabetes disease of the recipient (character)","Recipient comobidities date (date object in R)","Cancer of the recipient (character)","Date first get on the waiting list(date object in R)","Status on the waiting list (character)","Listing time of the recipient (numeric)","EPTS of the recipient (numeric)","A risk score based on survival prediciton of the recipient (numeric)","Original allocation algorithm of the recipient (character)","Original id of the recipient (character)","Original Date first get on the waiting list (date object in R)","Original dialysis start date (date object in R)","Transplant date (date object in R)","Birth date (date object in R)","PRA group (character)","Age group (character)"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>recipient_feature<\/th>\n      <th>recipient_explain<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="allocation-process-under-australia-kidney-allocation-algorithm" class="section level1">
<h1 class="hasAnchor">
<a href="#allocation-process-under-australia-kidney-allocation-algorithm" class="anchor"></a>Allocation process under <strong>Australia kidney allocation algorithm</strong>
</h1>
<p>The process is implemented through one huge function named <code>runSimulation5.4</code> which calls dependent functions inside itself. This below example shows how to use this function and details about each argument are illustrated.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># example allocation process</span>
<span class="va">result</span> <span class="op">=</span> <span class="fu">simKAP</span><span class="fu">::</span><span class="fu"><a href="../reference/run_simulation.html">run_simulation</a></span><span class="op">(</span><span class="va">recip_sample_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, 
                                <span class="va">raw_donor_matrix</span>,
                                algorithm_FUN <span class="op">=</span> <span class="fu">simKAP</span><span class="fu">::</span><span class="va"><a href="../reference/allocation_national.html">allocation_national</a></span>,
                                eligible_FUN <span class="op">=</span> <span class="fu">simKAP</span><span class="fu">::</span><span class="va"><a href="../reference/selection_default.html">selection_default</a></span>,
                                matching_FUN <span class="op">=</span> <span class="fu">simKAP</span><span class="fu">::</span><span class="va"><a href="../reference/dm_national_formula.html">dm_national_formula</a></span>,
                                waitlist_FUN <span class="op">=</span> <span class="fu">simKAP</span><span class="fu">::</span><span class="va"><a href="../reference/dynamic_waitlist.html">dynamic_waitlist</a></span>,
                                state_algorithm <span class="op">=</span> <span class="cn">TRUE</span>,
                                national_algorithm_threshold <span class="op">=</span> <span class="fl">54000000</span>,
                                state_algorithm_FUN <span class="op">=</span> <span class="fu">simKAP</span><span class="fu">::</span><span class="va"><a href="../reference/australia_state_algorithm.html">australia_state_algorithm</a></span>,
                                state_eligible_FUN <span class="op">=</span> <span class="fu">simKAP</span><span class="fu">::</span><span class="va"><a href="../reference/australia_state_selection.html">australia_state_selection</a></span>,
                                state_matching_FUN <span class="op">=</span> <span class="fu">simKAP</span><span class="fu">::</span><span class="va"><a href="../reference/dm_state_formula.html">dm_state_formula</a></span>,
                                eligible_arg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>AB_priority <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
                                waitlist_arg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>waitlist_Risk <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,
                                resampleN <span class="op">=</span> <span class="fl">1</span>,
                                verbose <span class="op">=</span> <span class="cn">FALSE</span>,
                                num_donor <span class="op">=</span> <span class="fl">800</span>,num_recip <span class="op">=</span> <span class="fl">300</span>,
                                state_balance <span class="op">=</span> <span class="cn">TRUE</span>,
                                dynamic_waitlist <span class="op">=</span> <span class="cn">TRUE</span>, 
                                National_II <span class="op">=</span> <span class="cn">TRUE</span>,
                                is_parallel<span class="op">=</span><span class="cn">FALSE</span>,
                                ncores <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">result</span>,<span class="st">"simKAP_eval.rds"</span><span class="op">)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>
<code>recip_sample_list</code> is a list of length 10 with 10 different samples contains recipient features, we take one sample from it to be used as our recipient matrix.</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">recip_sample_list</span><span class="op">)</span>
<span class="co">#&gt; [1] 10</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">recip_sample_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;       recip_id recip_graftno recip_pra recip_blgroup recip_a1 recip_a2 recip_b1</span>
<span class="co">#&gt; 324 P8012631_1             1         0             A        1        2        8</span>
<span class="co">#&gt; 167 P7561113_1             1         0             A       30       32        7</span>
<span class="co">#&gt; 129 P7159736_1             1         0             A        2       24       18</span>
<span class="co">#&gt; 418 P9754808_1             1         2             A        1        2        8</span>
<span class="co">#&gt; 471 P9855484_1             1         6             A        2        3        7</span>
<span class="co">#&gt; 299 P7986678_1             1         1             A       11       24       62</span>
<span class="co">#&gt;     recip_b2 recip_dr1 recip_dr2 recip_dq1 recip_dq2 recip_state_initial</span>
<span class="co">#&gt; 324       50         3         7        NA        NA                 NSW</span>
<span class="co">#&gt; 167        8         8        11         2         7                 NSW</span>
<span class="co">#&gt; 129       44         7        11         2         7                 NSW</span>
<span class="co">#&gt; 418       51         3         8        NA        NA                 NSW</span>
<span class="co">#&gt; 471       51        14        15        NA        NA                 NSW</span>
<span class="co">#&gt; 299       75        15        15        NA         5                 NSW</span>
<span class="co">#&gt;     recip_state_current recip_age_rrtstart recip_sex</span>
<span class="co">#&gt; 324                 NSW                 43         F</span>
<span class="co">#&gt; 167                 NSW                 50         M</span>
<span class="co">#&gt; 129                 NSW                 14         F</span>
<span class="co">#&gt; 418                 NSW                 24         M</span>
<span class="co">#&gt; 471                 NSW                 21         M</span>
<span class="co">#&gt; 299                 NSW                 51         F</span>
<span class="co">#&gt;                   recip_eth_detailed recip_eth</span>
<span class="co">#&gt; 324                        Caucasoid      &lt;NA&gt;</span>
<span class="co">#&gt; 167    Sub-Saharan African (Specify)   AFRICAN</span>
<span class="co">#&gt; 129 Oceanian - Australian Aboriginal      &lt;NA&gt;</span>
<span class="co">#&gt; 418                        Caucasoid      &lt;NA&gt;</span>
<span class="co">#&gt; 471                        Caucasoid      &lt;NA&gt;</span>
<span class="co">#&gt; 299      South-East Asian - Filipino      &lt;NA&gt;</span>
<span class="co">#&gt;                                recip_primrenal recip_biopsy recip_creatinine</span>
<span class="co">#&gt; 324            Familial GN (Including Alports)            Y              981</span>
<span class="co">#&gt; 167                        Uncertain Diagnosis            Y              944</span>
<span class="co">#&gt; 129                   Medullary Cystic Disease            N             1847</span>
<span class="co">#&gt; 418                            Other (Specify)            N              680</span>
<span class="co">#&gt; 471 Focal Sclerosing GN (Including Hyalinosis)            Y              992</span>
<span class="co">#&gt; 299             Mesangial Proliferative (Iga+)            Y              647</span>
<span class="co">#&gt;     recip_height recip_weight recip_smoker recip_rrtstartdate recip_deathdate</span>
<span class="co">#&gt; 324        166.0         78.8       Former         2009-08-31            &lt;NA&gt;</span>
<span class="co">#&gt; 167        169.0         81.7        Never         2014-02-07            &lt;NA&gt;</span>
<span class="co">#&gt; 129        146.3         35.0        Never         2016-03-18            &lt;NA&gt;</span>
<span class="co">#&gt; 418        187.0         62.0        Never         2004-03-09            &lt;NA&gt;</span>
<span class="co">#&gt; 471        166.0         44.0       Former         2000-09-14            &lt;NA&gt;</span>
<span class="co">#&gt; 299        150.0         47.7        Never         2010-07-24            &lt;NA&gt;</span>
<span class="co">#&gt;     recip_state recip_age recip_waittime recip_lung recip_coronary recip_pvd</span>
<span class="co">#&gt; 324         NSW        49           2230          N              N         N</span>
<span class="co">#&gt; 167         NSW        54           1135          N              Y         N</span>
<span class="co">#&gt; 129         NSW        15            414          N              N         N</span>
<span class="co">#&gt; 418         NSW        32           2969          N              Y         S</span>
<span class="co">#&gt; 471         NSW        29           2981          N              N         N</span>
<span class="co">#&gt; 299         NSW        56           1784          N              Y         N</span>
<span class="co">#&gt;     recip_cvd recip_diabetes recip_comorb_date recip_cancer recip_liststartdate</span>
<span class="co">#&gt; 324         S              N        2014-12-31           No          2015-09-28</span>
<span class="co">#&gt; 167         N              N        2016-12-31           No          2016-09-27</span>
<span class="co">#&gt; 129         N              N        2016-12-31           No          2016-12-06</span>
<span class="co">#&gt; 418         N              N        2011-12-31          Yes          2011-01-25</span>
<span class="co">#&gt; 471         N              N        2007-12-31           No          2006-06-28</span>
<span class="co">#&gt; 299         N              N        2014-12-31           No          2011-10-14</span>
<span class="co">#&gt;     recip_waitstatus recip_listtime  recip_epts riskscore recip_algorithm</span>
<span class="co">#&gt; 324           Active             11 1.508669665  428.1523           State</span>
<span class="co">#&gt; 167           Active            172 1.571033572  519.4296           State</span>
<span class="co">#&gt; 129           Active            151 0.001691208  584.8409           State</span>
<span class="co">#&gt; 418           Active            456 0.788597613  370.9716           State</span>
<span class="co">#&gt; 471           Active            868 0.648729266  428.3344           State</span>
<span class="co">#&gt; 299           Active           1337 1.778272034  417.9297           State</span>
<span class="co">#&gt;     recip_id_original recip_original_listdate recip_original_rrtstartdate</span>
<span class="co">#&gt; 324          P8012631              2015-09-28                  2009-08-31</span>
<span class="co">#&gt; 167          P7561113              2016-09-27                  2014-02-07</span>
<span class="co">#&gt; 129          P7159736              2016-12-06                  2016-03-18</span>
<span class="co">#&gt; 418          P9754808              2011-01-25                  2004-03-09</span>
<span class="co">#&gt; 471          P9855484              2006-06-28                  2000-09-14</span>
<span class="co">#&gt; 299          P7986678              2011-10-14                  2010-07-24</span>
<span class="co">#&gt;     recip_tx_date recip_birthdate pra_group recip_age_group</span>
<span class="co">#&gt; 324    2015-10-09      1966-10-09    [0,20)         [45,55)</span>
<span class="co">#&gt; 167    2017-03-18      1963-03-18    [0,20)         [45,55)</span>
<span class="co">#&gt; 129    2017-05-06      2002-05-06    [0,20)          [0,45)</span>
<span class="co">#&gt; 418    2012-04-25      1980-04-25    [0,20)          [0,45)</span>
<span class="co">#&gt; 471    2008-11-12      1979-11-12    [0,20)          [0,45)</span>
<span class="co">#&gt; 299    2015-06-12      1959-06-12    [0,20)         [55,65)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">recip_sample_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] 1483   49</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>
<code>raw_donor_matrix</code> is a donor matrix contains donor features</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">raw_donor_matrix</span><span class="op">)</span>
<span class="co">#&gt;   donor_source donor_state donor_blgroup donor_a1 donor_a2 donor_b1 donor_b2</span>
<span class="co">#&gt; 1     Deceased         QLD             O        1       25        8       27</span>
<span class="co">#&gt; 2     Deceased         NSW             A       23       68       44       44</span>
<span class="co">#&gt; 3     Deceased         QLD             O        2       68       57       60</span>
<span class="co">#&gt; 4     Deceased         QLD             B       11       34        8       18</span>
<span class="co">#&gt; 5     Deceased         QLD             A        1        3        7        8</span>
<span class="co">#&gt; 6     Deceased         QLD             O        1       68        8       35</span>
<span class="co">#&gt;   donor_dr1 donor_dr2 donor_dq1 donor_dq2 donor_height donor_weight</span>
<span class="co">#&gt; 1        15        17         2         6          175           75</span>
<span class="co">#&gt; 2         4        15         6         8          173           80</span>
<span class="co">#&gt; 3         4         9         7         9          170           70</span>
<span class="co">#&gt; 4         7        13         2         6          169           87</span>
<span class="co">#&gt; 5        15        17         2         6          168           50</span>
<span class="co">#&gt; 6         3         7        NA         2          167           70</span>
<span class="co">#&gt;          donor_eth_code donor_eth_country donor_eth donor_diabetes</span>
<span class="co">#&gt; 1 Oceanian - Australian              &lt;NA&gt; Caucasian    No Diabetes</span>
<span class="co">#&gt; 2 Oceanian - Australian              &lt;NA&gt; Caucasian    No Diabetes</span>
<span class="co">#&gt; 3 Oceanian - Australian              &lt;NA&gt; Caucasian    No Diabetes</span>
<span class="co">#&gt; 4 Oceanian - Australian              &lt;NA&gt; Caucasian    No Diabetes</span>
<span class="co">#&gt; 5 Oceanian - Australian              &lt;NA&gt; Caucasian    No Diabetes</span>
<span class="co">#&gt; 6 Oceanian - Australian              &lt;NA&gt; Caucasian    No Diabetes</span>
<span class="co">#&gt;   donor_hypertension donor_smoker donor_id                  donor_death</span>
<span class="co">#&gt; 1                 No      Current  D988290       Traumatic Brain Injury</span>
<span class="co">#&gt; 2                 No       Former  D988863 Cerebral Hypoxia / Ischaemia</span>
<span class="co">#&gt; 3                 No        Never  D991428       Traumatic Brain Injury</span>
<span class="co">#&gt; 4                 No      Current  D843391 Cerebral Hypoxia / Ischaemia</span>
<span class="co">#&gt; 5                 No        Never  D990169 Cerebral Hypoxia / Ischaemia</span>
<span class="co">#&gt; 6                 No      Current D1006042     Intracranial Haemorrhage</span>
<span class="co">#&gt;   donor_dcd donor_creatinine donor_age donor_sex donor_kdri    tx_date</span>
<span class="co">#&gt; 1         N               53        39         M  1.0291885 2017-03-02</span>
<span class="co">#&gt; 2         Y              259        44         M  1.1770381 2016-12-26</span>
<span class="co">#&gt; 3         Y              199        17         M  0.8896358 2016-09-30</span>
<span class="co">#&gt; 4         Y               72        45         M  1.0281746 2017-11-17</span>
<span class="co">#&gt; 5         Y               76        17         F  0.8375934 2016-11-28</span>
<span class="co">#&gt; 6         Y               31        51         F  1.1623594 2016-01-14</span>
<span class="co">#&gt;   num_kidney donor_rank</span>
<span class="co">#&gt; 1          2 0.26067019</span>
<span class="co">#&gt; 2          1 0.39894180</span>
<span class="co">#&gt; 3          2 0.14038801</span>
<span class="co">#&gt; 4          2 0.25820106</span>
<span class="co">#&gt; 5          2 0.09664903</span>
<span class="co">#&gt; 6          2 0.38765432</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">raw_donor_matrix</span><span class="op">)</span>
<span class="co">#&gt; [1] 2835   29</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><p><code>algorithm_FUN</code> and <code>state_algorithm_FUN</code> implement the Australia national and state allocation algorithms, notice here if you have your own algorithm, you can change this to your function name.</p></li>
<li><p><code>eligible_FUN</code> gives options to customise the eligible recipient pool, which means if you want to have a different pool with further restriction on eligible recipients, you can change it here.</p></li>
</ol>
<p>This gives us a <code>list</code> of length 4 as the output (notice that you can take our saved result to have a look) and based on this list, you can analyse and demonstrate with your own preference.</p>
<p>The first one is the matched recipients and donors dataset with all <strong>recipient features</strong>, <strong>donor features</strong> and <strong>transplant matchability features</strong>. The second one is all those disgarded donor kidneys with the associated donor kidney features. The third one contains all those different donor-recipient state kidneys, i.e. those kidneys to achieve state balance. The last one is the dynamic waiting list results (corresponding to each recipient in the first full dataset)</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simKAP_eval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"simKAP_eval.rds"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">simKAP_eval</span><span class="op">)</span>
<span class="co">#&gt; [1] 4</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">simKAP_eval</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] 1208   85</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">simKAP_eval</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] 74 29</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">simKAP_eval</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] 65 32</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">simKAP_eval</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] 799   7</span></code></pre></div>
</div>
<div id="customisable-allocation-process" class="section level1">
<h1 class="hasAnchor">
<a href="#customisable-allocation-process" class="anchor"></a>Customisable allocation process</h1>
<p>This example simulation process shows the paried result under the <code>CORisk allocation algorithm</code> with a threshold number 0.2 introduced in our paper. Detailed main changes for this new algorithm compared with the above one are: <code>eligible_FUN</code>, <code>matching_FUN</code>, <code>state_matching_FUN</code>, <code>waitlist_FUN</code>. With no specification of <code>matching_FUN</code>, <code>state_matching_FUN</code>, <code>waitlist_FUN</code>, the dynamic waiting list and share decision making procedures are not implemented in this new algorithm. The threshold number is specified through the <code>eligible_arg</code> argument using <code>threshold_number=0.2</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">result_new</span> <span class="op">=</span> <span class="fu">simKAP</span><span class="fu">::</span><span class="fu"><a href="../reference/run_simulation.html">run_simulation</a></span><span class="op">(</span><span class="va">recip_sample_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, 
                                    <span class="va">raw_donor_matrix</span>,
                                    algorithm_FUN <span class="op">=</span> <span class="va">allocation_national</span>,
                                    eligible_FUN <span class="op">=</span> <span class="va">selection_corisk</span>,
                                    matching_FUN <span class="op">=</span> <span class="va">select_max</span>,
                                    state_algorithm <span class="op">=</span> <span class="cn">TRUE</span>,
                                    national_algorithm_threshold <span class="op">=</span> <span class="fl">54000000</span>,
                                    state_algorithm_FUN <span class="op">=</span> <span class="va">australia_state_algorithm</span>,
                                    state_eligible_FUN <span class="op">=</span> <span class="va">australia_state_selection</span>,
                                    state_matching_FUN <span class="op">=</span> <span class="va">select_max</span>,
                                    eligible_arg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>AB_priority <span class="op">=</span> <span class="cn">TRUE</span>,threshold_number<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span>,
                                    resampleN <span class="op">=</span> <span class="fl">1</span>,
                                    verbose <span class="op">=</span> <span class="cn">FALSE</span>,
                                    num_donor <span class="op">=</span> <span class="fl">800</span>,num_recip <span class="op">=</span> <span class="fl">300</span>,
                                    state_balance <span class="op">=</span> <span class="cn">TRUE</span>,
                                    dynamic_waitlist <span class="op">=</span> <span class="cn">FALSE</span>, 
                                    National_II <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">result_new</span>,<span class="st">"us0.2full.rds"</span><span class="op">)</span></code></pre></div>
<p>This gives us a <code>list</code> of length 3 as the output (notice that you can take our saved result to have a look) and based on this list, you can analyse and demonstrate with your own preference.</p>
<p>The first one is the matched recipients and donors dataset with all <strong>recipient features</strong>, <strong>donor features</strong> and <strong>transplant matchability features</strong>. The second one is all those discarded donor kidneys with the associated donor kidney features. The third one is</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">us0.2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"us0.2full.rds"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">us0.2</span><span class="op">)</span>
<span class="co">#&gt; [1] 3</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">us0.2</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] 1152   84</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">us0.2</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] 96 29</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">us0.2</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] 91 32</span></code></pre></div>
</div>
<div id="session-info" class="section level1">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session Info</h1>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="st">"simKAP"</span><span class="op">)</span>
<span class="co">#&gt; R version 4.1.1 (2021-08-10)</span>
<span class="co">#&gt; Platform: x86_64-apple-darwin17.0 (64-bit)</span>
<span class="co">#&gt; Running under: macOS Catalina 10.15.7</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; BLAS:   /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRblas.0.dylib</span>
<span class="co">#&gt; LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt; [1] en_AU.UTF-8/en_AU.UTF-8/en_AU.UTF-8/C/en_AU.UTF-8/en_AU.UTF-8</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; character(0)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt; [1] simKAP_0.1.0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] Rcpp_1.0.7        knitr_1.33        magrittr_2.0.1    grDevices_4.1.1  </span>
<span class="co">#&gt;  [5] R6_2.5.0          ragg_1.1.3        rlang_0.4.11      foreach_1.5.1    </span>
<span class="co">#&gt;  [9] fastmap_1.1.0     stringr_1.4.0     tools_4.1.1       utils_4.1.1      </span>
<span class="co">#&gt; [13] parallel_4.1.1    DT_0.18           xfun_0.25         snow_0.4-3       </span>
<span class="co">#&gt; [17] jquerylib_0.1.4   crosstalk_1.1.1   iterators_1.0.13  htmltools_0.5.1.1</span>
<span class="co">#&gt; [21] stats_4.1.1       systemfonts_1.0.2 datasets_4.1.1    yaml_2.2.1       </span>
<span class="co">#&gt; [25] digest_0.6.27     rprojroot_2.0.2   base_4.1.1        pkgdown_1.6.1    </span>
<span class="co">#&gt; [29] crayon_1.4.1      doSNOW_1.0.19     textshaping_0.3.5 codetools_0.2-18 </span>
<span class="co">#&gt; [33] sass_0.4.0        htmlwidgets_1.5.3 graphics_4.1.1    fs_1.5.0         </span>
<span class="co">#&gt; [37] memoise_2.0.0     cachem_1.0.5      evaluate_0.14     rmarkdown_2.10   </span>
<span class="co">#&gt; [41] stringi_1.7.3     compiler_4.1.1    bslib_0.2.5.1     generics_0.1.0   </span>
<span class="co">#&gt; [45] methods_4.1.1     desc_1.3.0        lubridate_1.7.10  jsonlite_1.7.2</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Yunwei Zhang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
